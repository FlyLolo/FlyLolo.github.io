<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>三. 项目结构 | FlyLolo 闲聊编程</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="没事敲敲代码">
    
    <link rel="preload" href="/assets/css/0.styles.b23bcaa9.css" as="style"><link rel="preload" href="/assets/js/app.5c4124d9.js" as="script"><link rel="preload" href="/assets/js/2.5052fd89.js" as="script"><link rel="preload" href="/assets/js/66.c3c68bbd.js" as="script"><link rel="prefetch" href="/assets/js/10.ebd354ff.js"><link rel="prefetch" href="/assets/js/11.c0ba7b39.js"><link rel="prefetch" href="/assets/js/12.d2df4345.js"><link rel="prefetch" href="/assets/js/13.ad189de6.js"><link rel="prefetch" href="/assets/js/14.211e1c27.js"><link rel="prefetch" href="/assets/js/15.bc9f8b57.js"><link rel="prefetch" href="/assets/js/16.5cc9b653.js"><link rel="prefetch" href="/assets/js/17.4281fea3.js"><link rel="prefetch" href="/assets/js/18.1c3b6824.js"><link rel="prefetch" href="/assets/js/19.19526aaa.js"><link rel="prefetch" href="/assets/js/20.55520ac3.js"><link rel="prefetch" href="/assets/js/21.68aa2210.js"><link rel="prefetch" href="/assets/js/22.976b6f6a.js"><link rel="prefetch" href="/assets/js/23.9241ad9a.js"><link rel="prefetch" href="/assets/js/24.87e81add.js"><link rel="prefetch" href="/assets/js/25.5a324370.js"><link rel="prefetch" href="/assets/js/26.6e0c7b3a.js"><link rel="prefetch" href="/assets/js/27.c2db3589.js"><link rel="prefetch" href="/assets/js/28.f504554f.js"><link rel="prefetch" href="/assets/js/29.0b8cbb3f.js"><link rel="prefetch" href="/assets/js/3.dc0bd479.js"><link rel="prefetch" href="/assets/js/30.18cf6f70.js"><link rel="prefetch" href="/assets/js/31.90a5f0a4.js"><link rel="prefetch" href="/assets/js/32.454348da.js"><link rel="prefetch" href="/assets/js/33.1c21d0c1.js"><link rel="prefetch" href="/assets/js/34.a2fc1109.js"><link rel="prefetch" href="/assets/js/35.7123c8b5.js"><link rel="prefetch" href="/assets/js/36.6a74523e.js"><link rel="prefetch" href="/assets/js/37.4a0d5e49.js"><link rel="prefetch" href="/assets/js/38.870830b5.js"><link rel="prefetch" href="/assets/js/39.7a99876d.js"><link rel="prefetch" href="/assets/js/4.2543b7ad.js"><link rel="prefetch" href="/assets/js/40.1ab956e2.js"><link rel="prefetch" href="/assets/js/41.e2cd491a.js"><link rel="prefetch" href="/assets/js/42.8118b296.js"><link rel="prefetch" href="/assets/js/43.3b58128f.js"><link rel="prefetch" href="/assets/js/44.1648ce27.js"><link rel="prefetch" href="/assets/js/45.0e2feba0.js"><link rel="prefetch" href="/assets/js/46.8cacc6f0.js"><link rel="prefetch" href="/assets/js/47.85a42084.js"><link rel="prefetch" href="/assets/js/48.887f0baf.js"><link rel="prefetch" href="/assets/js/49.311ea494.js"><link rel="prefetch" href="/assets/js/5.82bf0454.js"><link rel="prefetch" href="/assets/js/50.1a3416b2.js"><link rel="prefetch" href="/assets/js/51.17ac5138.js"><link rel="prefetch" href="/assets/js/52.0e0119e0.js"><link rel="prefetch" href="/assets/js/53.a74775a2.js"><link rel="prefetch" href="/assets/js/54.4dc1f4cf.js"><link rel="prefetch" href="/assets/js/55.782ceae6.js"><link rel="prefetch" href="/assets/js/56.d371faac.js"><link rel="prefetch" href="/assets/js/57.42acf1f9.js"><link rel="prefetch" href="/assets/js/58.508c5ac0.js"><link rel="prefetch" href="/assets/js/59.a747c5df.js"><link rel="prefetch" href="/assets/js/6.d83b86ff.js"><link rel="prefetch" href="/assets/js/60.1a0f169d.js"><link rel="prefetch" href="/assets/js/61.eb35190d.js"><link rel="prefetch" href="/assets/js/62.508f7c4c.js"><link rel="prefetch" href="/assets/js/63.4c9bbdbe.js"><link rel="prefetch" href="/assets/js/64.5f784752.js"><link rel="prefetch" href="/assets/js/65.83e85dd4.js"><link rel="prefetch" href="/assets/js/67.15ce6b9a.js"><link rel="prefetch" href="/assets/js/68.2f1ad103.js"><link rel="prefetch" href="/assets/js/69.e220c066.js"><link rel="prefetch" href="/assets/js/7.fbd6423b.js"><link rel="prefetch" href="/assets/js/70.024cc331.js"><link rel="prefetch" href="/assets/js/71.424df8a7.js"><link rel="prefetch" href="/assets/js/72.87abc657.js"><link rel="prefetch" href="/assets/js/73.ea6962e5.js"><link rel="prefetch" href="/assets/js/74.c50c111e.js"><link rel="prefetch" href="/assets/js/75.4d2a7dbe.js"><link rel="prefetch" href="/assets/js/76.49e30c54.js"><link rel="prefetch" href="/assets/js/77.5d8c8f6d.js"><link rel="prefetch" href="/assets/js/78.5b4f8e29.js"><link rel="prefetch" href="/assets/js/79.316dc7d8.js"><link rel="prefetch" href="/assets/js/8.a45bb22d.js"><link rel="prefetch" href="/assets/js/80.b1c365a1.js"><link rel="prefetch" href="/assets/js/81.cb25e543.js"><link rel="prefetch" href="/assets/js/82.7bc18643.js"><link rel="prefetch" href="/assets/js/83.6c0ee3d0.js"><link rel="prefetch" href="/assets/js/84.f8184dc3.js"><link rel="prefetch" href="/assets/js/85.b0a7f43e.js"><link rel="prefetch" href="/assets/js/86.af5fcb58.js"><link rel="prefetch" href="/assets/js/9.55a96ecc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b23bcaa9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="FlyLolo 闲聊编程" class="logo"> <span class="site-name can-hide">FlyLolo 闲聊编程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/dotnet/" class="nav-link router-link-active">
  .NET
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/db/" class="nav-link">
  DB
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/dotnet/" class="nav-link router-link-active">
  .NET
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/db/" class="nav-link">
  DB
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ASP.NET Core</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dotnet/" aria-current="page" class="sidebar-link">新书上市</a></li><li><a href="/dotnet/ASPNETCore2_1.html" class="sidebar-link">一. 概述</a></li><li><a href="/dotnet/ASPNETCore2_2.html" class="sidebar-link">二. 开发环境</a></li><li><a href="/dotnet/ASPNETCore2_3.html" aria-current="page" class="active sidebar-link">三. 项目结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/ASPNETCore2_3.html#_1-新建项目-选择类型" class="sidebar-link">1. 新建项目, 选择类型</a></li><li class="sidebar-sub-header"><a href="/dotnet/ASPNETCore2_3.html#_2-项目结构图" class="sidebar-link">2. 项目结构图</a></li><li class="sidebar-sub-header"><a href="/dotnet/ASPNETCore2_3.html#_3-小结" class="sidebar-link">3. 小结:</a></li></ul></li><li><a href="/dotnet/ASPNETCore2_4.html" class="sidebar-link">四. Layout与ViewStart</a></li><li><a href="/dotnet/ASPNETCore2_5.html" class="sidebar-link">五.服务的加载与运行</a></li><li><a href="/dotnet/ASPNETCore2_6.html" class="sidebar-link">六. 聊聊依赖注入</a></li><li><a href="/dotnet/ASPNETCore2_7.html" class="sidebar-link">七.启动背后的秘密</a></li><li><a href="/dotnet/ASPNETCore2_8.html" class="sidebar-link">八.图说管道</a></li><li><a href="/dotnet/ASPNETCore2_9.html" class="sidebar-link">九.发布到CentOS</a></li><li><a href="/dotnet/ASPNETCore2_10.html" class="sidebar-link">十.升级到2.1</a></li><li><a href="/dotnet/ASPNETCore2_11.html" class="sidebar-link">十一.运行后台任务</a></li><li><a href="/dotnet/ASPNETCore2_12.html" class="sidebar-link">十二.内置日志与Nlog</a></li><li><a href="/dotnet/ASPNETCore2_13.html" class="sidebar-link">十三.httpClient.GetAsync 报SSL错误</a></li><li><a href="/dotnet/ASPNETCore2_14.html" class="sidebar-link">十四.静态文件访问与授权</a></li><li><a href="/dotnet/ASPNETCore2_15.html" class="sidebar-link">十五.图解路由(2.1 or earler)</a></li><li><a href="/dotnet/ASPNETCore2_16.html" class="sidebar-link">十六.新的Endpoint路由方案</a></li><li><a href="/dotnet/ASPNETCore2_17.html" class="sidebar-link">十七.Action的执行</a></li><li><a href="/dotnet/ASPNETCore2_18.html" class="sidebar-link">十八.Filter的处理机制及执行顺序</a></li><li><a href="/dotnet/ASPNETCore2_19.html" class="sidebar-link">十九. Action参数的映射与模型绑定</a></li><li><a href="/dotnet/ASPNETCore2_20.html" class="sidebar-link">二十.Action的数据返回格式处理</a></li><li><a href="/dotnet/ASPNETCore2_21.html" class="sidebar-link">二十一. 内容协商与自定义返回格式</a></li><li><a href="/dotnet/ASPNETCore_22.html" class="sidebar-link">二十二. 多样性的配置方式</a></li><li><a href="/dotnet/ASPNETCore_23.html" class="sidebar-link">二十三. 配置的内部处理机制</a></li><li><a href="/dotnet/ASPNETCore_24.html" class="sidebar-link">二十四. Options模式的配置</a></li><li><a href="/dotnet/ASPNETCore_25.html" class="sidebar-link">二十五. TagHelper</a></li><li><a href="/dotnet/ASPNETCore2_26.html" class="sidebar-link">二十六. 应用JWT进行用户认证</a></li><li><a href="/dotnet/ASPNETCore2_27.html" class="sidebar-link">二十七. JWT与用户授权</a></li><li><a href="/dotnet/ASPNETCore_28.html" class="sidebar-link">二十八. 在Docker中部署</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>C# 其他</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="三-项目结构"><a href="#三-项目结构" class="header-anchor">#</a> 三. 项目结构</h1> <hr> <p>本章我们一起来对比着ASP.NET Framework版本看一下ASP.NET Core 2.0的项目结构.(此后的文章也尽量这样对比着, 方便学习理解.)</p> <p>关注差异, 也为项目迁移做准备.</p> <h2 id="_1-新建项目-选择类型"><a href="#_1-新建项目-选择类型" class="header-anchor">#</a> 1. 新建项目, 选择类型</h2> <p>新建项目, 选择.NET Core 有如下几种类型可选, 分别是Console, ASP.NET Core 的空项目, Web API</p> <p>我们选择ASP.NET Core Web App(MVC), 没有标注MVC的是采用Razor pages 的项目.</p> <p><img src="/blogimages/ASPNETCore2_3/548134-20180207212207779-1001668776.jpg" alt=""></p> <h2 id="_2-项目结构图"><a href="#_2-项目结构图" class="header-anchor">#</a> 2. 项目结构图</h2> <p>新建的项目结构如下图所示, 大体上和ASP.NET 的Framework版本差不多, 现在按照图上的数字标记逐一做一下介绍(Controller、Model就不介绍了, View中单独介绍一下几个特殊View).</p> <p><strong>按照标注的数字逐个做一下简单介绍, 先了解大概是干什么用的, 后面的文章会做详细的研究.</strong></p> <p>介绍的时候我会对比大家熟悉的ASP.NET Framework版本, 方便理解.</p> <p><img src="/blogimages/ASPNETCore2_3/548134-20180207230835763-894954850.png" alt=""></p> <h3 id="_1-dependencies-依赖项"><a href="#_1-dependencies-依赖项" class="header-anchor">#</a> ① Dependencies 依赖项</h3> <p>这里主要分两部分, NuGet和SDK, 目前这两部分下面都只有一项.</p> <p><strong>Nuget:</strong></p> <p>包含Microsoft.AspNetCore.All, 展开它看一下, 里面MVC、Razor、EF以及SQLLite都要,</p> <p>官方这样说: 它包含了</p> <ul><li><p>ASP.NET Core 团队支持的所有包。</p></li> <li><p>Entity Framework Core 支持的所有包。</p></li> <li><p>ASP.NET Core 和 Entity Framework Core 使用的内部和第三方依赖关系。</p></li></ul> <p>猛地一看, 这是一非常大而全的包了, 和之前说的模块化有点不一致, 而且无缘无故的让自己的项目引用了一些根本用不到的程序集, 非常不爽.</p> <p>其实这些程序集不会随着项目发布一起出现在部署包中, 不止没引用的, 包括引用的也不会. 这些已经存在于部署环境中了, 所以发布包不会变大反而会变小, 不必担心.</p> <p><strong>SDK:</strong></p> <p>SDk中包含了一项: Microsoft.NETCore.App, 它是.NET Core 的部分库。 也就是 <code>.NETCoreApp</code> 框架。 它依赖于更小的 <code>NETStandard.Library</code>。</p> <p>相对于上面的Microsoft.AspNetCore.All, 它同样是包含了一些程序集.但它似乎更&quot;基础&quot;一些.</p> <p><strong>二者异同</strong></p> <p>Microsoft.AspNetCore.All中大部分都是Microsoft.开头的一些程序集, 而Microsoft.NETCore.App中出现的大多数是我们熟悉的system.XXX的.</p> <p>二者的关系就像ASP.NET相对于.NET, 此处是Asp.NetCore相对于.Net Core.</p> <p>SDK同样是一个大而全的集和, 在部署的时候, SDK中的引用依然不会出现在部署包中, 如下图, 是不是很精简</p> <p><img src="/blogimages/ASPNETCore2_3/548134-20180208134140216-1713065500.png" alt=""></p> <h3 id="_2-launchsettings-json"><a href="#_2-launchsettings-json" class="header-anchor">#</a> ② launchSettings.json</h3> <p>顾名思义, 这是一个启动配置文件, json格式的. 通过上面的项目结构图可以发现, 常见的web.config或app.config等xml格式的config文件找不到了,</p> <p>都是json. 打开这个json看一下. 一项项的不好解释, 后来发现windows 中的 vs2017有个图形化的配置界面(右键当前项目-&gt;属性-&gt;调试),</p> <p>一个个介绍太麻烦了, 直接上图感受一下.</p> <p><img src="/blogimages/ASPNETCore2_3/548134-20180208142350138-1478919252.png" alt=""></p> <p>图下部分的Web服务器配置是我们熟悉的URL、身份认证以及SSL等配置.</p> <p>图的上部分对应json中的profiles中定义的两种配置,分别以IIS Express和以当前项目名HelloCore命名.</p> <p>切换该选项下面的配置项也会随之改变, 相当于是两个页, 每页中的配置对应json中相应的节点.</p> <h3 id="_3-layout-cshtml"><a href="#_3-layout-cshtml" class="header-anchor">#</a> ③ _Layout.cshtml</h3> <p>布局模板, 简单的说就是所有采用此模板的页面拥有大体一致的布局,</p> <p>举个例子, 我们的页面经常是这样的结构:</p> <p><img src="/blogimages/ASPNETCore2_3/548134-20180208150014560-42688859.png" alt=""></p> <p>Header、Footer和Navigation基本上是不变的, 打开_Layout.cshtml, 我们可以看到一个@RenderBody()标识, 它其实就是来定义Content部分的,</p> <p>继承此模板的页面只需要提供这部分内容即可.</p> <p>当然, 常见的还有类似@RenderSection(&quot;Scripts&quot;, required: false)这样的标识, 引用此模板的页面可以将该页的特定JS的引用放在对应的Section中.</p> <p>引用此模板, 只需在页首如下配置即可.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@<span class="token punctuation">{</span>
    Layout <span class="token operator">=</span> <span class="token string">&quot;~/Views/Shared/_Layout.cshtml&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>每个页都配置比较麻烦? ⑥ _ViewStart.cshtml 会帮忙.</p> <h3 id="_4-validationscriptspartial-cshtml"><a href="#_4-validationscriptspartial-cshtml" class="header-anchor">#</a> ④ _ValidationScriptsPartial.cshtml</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/lib/jquery-validation/dist/jquery.validate.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>打开此页面, 可以看到一些这样的引用, validation 顾名思义是用来做验证的, 我们经常看到这样的页面</p> <p><img src="/blogimages/ASPNETCore2_3/548134-20180208163938170-1351718798.png" alt=""></p> <p>当输入的格式不正确的时候, 给出提示, 最早我们经常是在输入后或者提交前用js将输入的内容正则验证一下,</p> <p>这个不用那么麻烦了, 我们通过如下代码引用_ValidationScriptsPartial.cshtml, 也就是采用jquery-validation来做验证</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token return-type class-name">@section</span> Scripts <span class="token punctuation">{</span>
    <span class="token return-type class-name">@<span class="token keyword">await</span></span> Html<span class="token punctuation">.</span><span class="token function">PartialAsync</span><span class="token punctuation">(</span><span class="token string">&quot;_ValidationScriptsPartial&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><span style="color:#ff0000;">注意: 默认的_Layout模板是未引用的, 因为不是所有页面都需要有输入操作.</span></p> <p>Model中设置验证方式</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ErrorMessage <span class="token operator">=</span><span class="token string">&quot;用户名不能为空!&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Display</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">&quot;用户名&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EmailAddress</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ErrorMessage <span class="token operator">=</span><span class="token string">&quot;Email格式不正确!&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Display</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">&quot;EMail&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> EMail <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>在页面添加验证即可:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">asp-validation-summary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>All<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-danger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">&lt;span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #0000ff<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>form-group<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>&gt;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">asp-&lt;span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #0000ff<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>for<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">asp-&lt;span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #0000ff<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>for<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #0000ff<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>form-control<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> /&gt;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">asp-validation-&lt;span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #0000ff<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>for<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #0000ff<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>text-danger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> #800000<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>validation细化起来内容还很多, 此处只是大概介绍一下, 后文会专题研究.</p> <h3 id="_5-viewimports-cshtml"><a href="#_5-viewimports-cshtml" class="header-anchor">#</a> ⑤ _ViewImports.cshtml</h3> <p>先不说这个, 再说一个消失了的Web.config. 就是Framework版本的MVC项目中的View目录下的那个.</p> <p><img src="/blogimages/ASPNETCore2_3/548134-20180208170048623-2111482412.png" alt=""></p> <p>在View中引用Model等的时候, 为了避免写using .... , 我们可以在这个config中添加这些引用</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web.webPages.razor</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span> <span class="token attr-name">factoryType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.3.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pages</span> <span class="token attr-name">pageBaseType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Web.Mvc.WebViewPage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>namespaces</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Web.Mvc<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Web.Mvc.Ajax<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Web.Mvc.Html<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Web.Optimization<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>System.Web.Routing<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FrameworkMVCTest<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FrameworkMVCTest.Model<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>namespaces</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pages</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web.webPages.razor</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>现在打开_ViewImports.cshtml,</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@<span class="token keyword">using</span> HelloCore
@<span class="token keyword">using</span> HelloCore<span class="token punctuation">.</span>Models
@addTagHelper <span class="token operator">*</span><span class="token punctuation">,</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">.</span>TagHelpers
</code></pre></div><p>这里其实就是实现了上面的功能.</p> <p>有一个比较特别的地方就是比原版MVC多了个@addTagHelper</p> <p>在上文的validation中我们看到过这样的代码</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">asp-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">asp-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>原来我们是这样写的</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@Html<span class="token punctuation">.</span><span class="token function">LabelFor</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>EMail<span class="token punctuation">)</span>
@Html<span class="token punctuation">.</span><span class="token function">EditorFor</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>EMail<span class="token punctuation">)</span>
@Html<span class="token punctuation">.</span><span class="token function">ValidationMessageFor</span><span class="token punctuation">(</span>m<span class="token operator">=&gt;</span>m<span class="token punctuation">.</span>EMail<span class="token punctuation">)</span>
</code></pre></div><p>初步看来这个 TagHelper 和 HtmlHelper 有点像, 具体先了解这么多, 后文细化.</p> <h3 id="_6-viewstart-cshtml"><a href="#_6-viewstart-cshtml" class="header-anchor">#</a> ⑥ _ViewStart.cshtml</h3> <p>这个打开就一句话,</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@<span class="token punctuation">{</span>
    Layout <span class="token operator">=</span> <span class="token string">&quot;_Layout&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个页面中的内容会在所有View执行前执行, 现在这句话就是给所有的View一个默认的Layout模板.</p> <p>所以在View中这样写</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@<span class="token punctuation">{</span>
    Layout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>和这样写</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>是不一样的, 第一种是告诉这个View不采用任何模板.</p> <p>第二种写法是什么都不干, 所以它会采用_ViewStart.cshtml中指定的模板.</p> <p>当然, 这个_ViewStart.cshtml的作用不只是写这么一句话, 我们还可以在这写一些其他需要&quot;通用&quot;执行的内容.</p> <h3 id="_7-wwwroot"><a href="#_7-wwwroot" class="header-anchor">#</a> ⑦ wwwroot</h3> <p>看这名字好像是IIS的默认网站根目录, 它包含了所有的&quot;前端&quot;的静态文件,  css、image、JS以及一个名为lib的文件夹.</p> <p>lib中默认内容是bootstrap和jquery.</p> <p>在Startup中, 会调用一个无参数的UseStaticFiles()方法, 将此目录标记到网站根目录.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IHostingEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//.....        </span>
    app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//.....</span>

<span class="token punctuation">}</span>
</code></pre></div><p>具体静态文件的路径及相关自定义配置, 授权等后文详细研究.</p> <h3 id="_8-appsettings-json和appsettings-development-json"><a href="#_8-appsettings-json和appsettings-development-json" class="header-anchor">#</a> ⑧ appsettings.json和appsettings.Development.json</h3> <p>这就是原来的framework版本的MVC的Web.config文件了.</p> <p>不过这个算是够精简的了, 默认情况没几句话,只有对于log日志的相关配置,</p> <p>当然正常项目中我们要配置的肯定不止这一点, 举个例子, 数据库连接</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;ConnectionStrings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;DefaultConnection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Server=(localdb)\\mssqllocaldb;Database=ContosoUniversity1;Trusted_Connection=True;MultipleActiveResultSets=true&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;Logging&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;IncludeScopes&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;LogLevel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;Default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-bundleconfig-json"><a href="#_9-bundleconfig-json" class="header-anchor">#</a> ⑨ bundleconfig.json</h3> <p>默认文件内容如下:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;outputFileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wwwroot/css/site.min.css&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;inputFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;wwwroot/css/site.css&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;outputFileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wwwroot/js/site.min.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;inputFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;wwwroot/js/site.js&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// Optionally specify minification options</span>
    <span class="token property">&quot;minify&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;renameLocals&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// Optionally generate .map file</span>
    <span class="token property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>这里主要涉及两个概念:</p> <p>1.Bunding</p> <p>可以理解为绑定或者合并, 也就是把几个文件合并成一个大文件, 减少请求次数.</p> <p>上文的代码可以看到, inputFiles 是一个数组, 而outputFileName 是一个单独的文件名,</p> <p>以css为例, inputFiles里面已经有一个文件 wwwroot/css/site.css, 假如现在页面还需要一个wwwroot/css/skin.css,</p> <p>如果不做合并, 页面打开的时候就需要分别请求这两个文件, 做了合并之后, 即将这个skin.css文件也写入数组中, 只要请求</p> <p>/css/site.min.css这一个文件即可.</p> <p>2.Minification</p> <p>翻译为缩减, 即将代码中注释和多余空格等删除, 甚至将变量名改为一个字符来缩减文件的大小.</p> <p>例如下面的JS代码</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>AddAltToImg <span class="token operator">=</span> function <span class="token punctuation">(</span>imageTagAndImageID<span class="token punctuation">,</span> imageContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">///&lt;signature&gt;</span>
    <span class="token comment">///&lt;summary&gt; Adds an alt tab to the image</span>
    <span class="token comment">// &lt;/summary&gt;</span>
    <span class="token comment">//&lt;param name=&quot;imgElement&quot; type=&quot;String&quot;&gt;The image selector.&lt;/param&gt;</span>
    <span class="token comment">//&lt;param name=&quot;ContextForImage&quot; type=&quot;String&quot;&gt;The image context.&lt;/param&gt;</span>
    <span class="token comment">///&lt;/signature&gt;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> imageElement <span class="token operator">=</span> $<span class="token punctuation">(</span>imageTagAndImageID<span class="token punctuation">,</span> imageContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    imageElement<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>'alt'<span class="token punctuation">,</span> imageElement<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>'id'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>ID<span class="token operator">/</span><span class="token punctuation">,</span> ''<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>缩减后的代码:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>AddAltToImg<span class="token operator">=</span><span class="token function">function</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token class-name"><span class="token keyword">var</span></span> i<span class="token operator">=</span>$<span class="token punctuation">(</span>n<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;alt&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>ID<span class="token operator">/</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>一下就减少了好多.</p> <p>通过以上两种方式组合不但减少了请求次数,还减小了请求的静态文件的总大小, 从而提高加载时间和性能.</p> <p>在上文查看_layout模板文件的时候我们就见过这样的代码:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/lib/bootstrap/dist/css/bootstrap.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/css/site.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">exclude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.7/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">asp-fallback-href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/lib/bootstrap/dist/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">asp-fallback-test-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sr-only<span class="token punctuation">&quot;</span></span> <span class="token attr-name">asp-fallback-test-property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position<span class="token punctuation">&quot;</span></span> <span class="token attr-name">asp-fallback-test-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>absolute<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/css/site.min.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">asp-append-version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>详细的配置说明暂时不说, 大概的意思就是在Development模式下加载未绑定和缩减的文件, 方便阅读和调试.</p> <p>和非Development情况下,加载处理过的文件来提高性能.</p> <h3 id="_10-program-cs"><a href="#_10-program-cs" class="header-anchor">#</a> ⑩ Program.cs</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">BuildWebHost</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IWebHost</span> <span class="token function">BuildWebHost</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        WebHost<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里有一个非常熟悉的Main方法, 也就是应用的起点, 启动后通过<code>UseStartup&lt;Startup&gt;()</code>指定下文的Startup启动文件进行启动.</p> <h3 id="_11-startup-cs"><a href="#_11-startup-cs" class="header-anchor">#</a> ⑪ Startup.cs</h3> <p>这是Mvc Core非常重要的地方, 包括加载配置, 通过依赖注入加载组件, 注册路由等都在此处进行.</p> <p>默认的代码中:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IHostingEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//指定错误页</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseDeveloperExceptionPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseExceptionHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/Home/Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//指定静态文件</span>

<span class="token comment">//设置路由</span>
    app<span class="token punctuation">.</span><span class="token function">UseMvc</span><span class="token punctuation">(</span>routes <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
            <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">template</span><span class="token punctuation">:</span> <span class="token string">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如上图所示, 默认情况下设置了两种不同状态下的错误页, 指定静态文件并且设置了路由.</p> <p>在这里, 我们可以向管道中通过中间件的方式插入我们需要的工作内容.</p> <p>比如我们还可以用app.UseAuthentication()来做身份验证.</p> <p>我们使用 <code>Use</code>、<code>Run</code> 和 <code>Map</code> 来配置 HTTP 管道。</p> <p><code>Use</code> 方法可使管道短路（即不调用 <code>next</code> 请求委托）。</p> <p><code>Run</code> 是一种约定，并且某些中间件组件可公开在管道末尾运行的 <code>Run[Middleware]</code> 方法。</p> <p><code>Map*</code> 扩展用作约定来创建管道分支。</p> <p>此处涉及内容非常多, 比如管道机制、路由注册、身份认证等都需要专题研究.</p> <h3 id="_12-bowerrc和bower-json"><a href="#_12-bowerrc和bower-json" class="header-anchor">#</a> ⑫ .bowerrc和bower.json</h3> <p>bower是一款优秀的前端包及依赖管理工具,.bowerrc指定了文件位置, bower.json则进行了详细的配置,如下面的bootstrap和jquery</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asp.net&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bootstrap&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.3.7&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jquery&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jquery-validation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.14.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jquery-validation-unobtrusive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.2.6&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>详细的使用方法就不在这里介绍了.</p> <h2 id="_3-小结"><a href="#_3-小结" class="header-anchor">#</a> 3. 小结:</h2> <p>刚新建的项目的结构大体就是这样,  主要功能介绍完了就是一个个详细研究了.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dotnet/ASPNETCore2_2.html" class="prev">
        二. 开发环境
      </a></span> <span class="next"><a href="/dotnet/ASPNETCore2_4.html">
        四. Layout与ViewStart
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5c4124d9.js" defer></script><script src="/assets/js/2.5052fd89.js" defer></script><script src="/assets/js/66.c3c68bbd.js" defer></script>
  </body>
</html>
