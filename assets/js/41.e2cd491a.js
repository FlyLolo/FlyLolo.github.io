(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{313:function(t,s,a){"use strict";function n(t,s,a,n,e,p,r,c){var o,v="function"==typeof t?t.options:t;if(s&&(v.render=s,v.staticRenderFns=a,v._compiled=!0),n&&(v.functional=!0),p&&(v._scopeId="data-v-"+p),r?(o=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},v._ssrRegister=o):e&&(o=c?function(){e.call(this,(v.functional?this.parent:this).$root.$options.shadowRoot)}:e),o)if(v.functional){v._injectStyles=o;var _=v.render;v.render=function(t,s){return o.call(s),_(t,s)}}else{var l=v.beforeCreate;v.beforeCreate=l?[].concat(l,o):[o]}return{exports:t,options:v}}a.d(s,"a",(function(){return n}))},407:function(t,s,a){"use strict";a.r(s);var n=a(313),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("主要用到 System.Runtime.Caching")]),t._v(" "),a("p",[t._v("框架自动给了一个默认值 MemoryCache.Default;")]),t._v(" "),a("p",[t._v("查看微软关于"),a("a",{attrs:{href:"https://msdn.microsoft.com/zh-cn/library/system.runtime.caching.memorycache(v=vs.110).aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("MemoryCache"),a("OutboundLink")],1),t._v("的介绍,可以看到它有Add、Get、Set 、 Contains 、Remove等几个方法, 也就是我们常用的了,比较简单")]),t._v(" "),a("p",[t._v("网上找了一段对这个封装的代码:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Represents a MemoryCacheCache")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CacheManager")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("ObjectCache")]),t._v(" Cache\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" MemoryCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bool")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Gets or sets the value associated with the specified key.")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <typeparam name="T">Type</typeparam>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <param name="key">The key of the value to get.</param>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <returns>The value associated with the specified key.</returns>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("T")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token generic-method"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),a("span",{pre:!0,attrs:{class:"token generic class-name"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("T"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("T"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Adds the specified key and object to the cache.")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <param name="key">key</param>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <param name="data">Data</param>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <param name="cacheTime">Cache time</param>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")])]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" cacheTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" policy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("CacheItemPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AbsoluteExpiration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DateTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Now "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" TimeSpan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FromMinutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("CacheItem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Gets a value indicating whether the value associated with the specified key is cached")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <param name="key">key</param>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <returns>Result</returns>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bool")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Removes the value with the specified key from the cache")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <param name="key">/key</param>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Removes items by pattern")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <param name="pattern">pattern</param>')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("RemoveByPattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" pattern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" regex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pattern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" RegexOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Singleline "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" RegexOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Compiled "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" RegexOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IgnoreCase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" keysToRemove "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("List"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" item "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsMatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        keysToRemove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" key "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" keysToRemove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// <summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Clear all cache data")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// </summary>")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Clear")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" item "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("框架提供了缓存的更新机制")]),t._v(" "),a("p",[t._v("查看MemoryCache的Add方法:Add"),a("span",[t._v("(CacheItem, CacheItemPolicy)")])]),t._v(" "),a("p",[t._v("其中的参数CacheItemPolicy有一个ChangeMonitors属性, 该属性可选项为")]),t._v(" "),a("p",[t._v("System.Runtime.Caching"),a("span",[t._v(".CacheEntryChangeMonitor")]),a("br"),t._v("\nSystem.Runtime.Caching"),a("span",[t._v(".FileChangeMonitor")]),a("br"),t._v("\nSystem.Runtime.Caching"),a("span",[t._v(".SqlChangeMonitor")])]),t._v(" "),a("p",[t._v("可以看出添加cache的时候可以设置此cache的几种类型的依赖")]),t._v(" "),a("p",[t._v("网上看到有FileChangeMonitor的例子, 现在小罗遇到的需求是需要根据系统表来更新缓存,")]),t._v(" "),a("p",[t._v("即数据库中的数据发生了改变, 此时更新本次添加的缓存")]),t._v(" "),a("p",[t._v("对上面的代码添加方法")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetWithSql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")])]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" connStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CacheEntryRemovedCallback")]),t._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                Cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("CacheItem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SqlChangePolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("CacheItemPolicy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SqlChangePolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" connStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CacheEntryRemovedCallback")]),t._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                SqlDependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlConnection")]),t._v(" conn "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("SqlConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlCommand")]),t._v(" command "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("SqlCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Notification "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlDependency")]),t._v(" dependency "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("SqlDependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddCommandDependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SqlChangeMonitor")]),t._v(" monitor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("SqlChangeMonitor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CacheItemPolicy")]),t._v(" policy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("CacheItemPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ChangeMonitors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ExecuteScalar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AbsoluteExpiration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DateTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Now "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" TimeSpan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FromMinutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemovedCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("添加cache项的时候, 传入SqlConnection和相应的sql, 目的是当sql对应的查询结果发生变化的时候, 清除此项缓存")]),t._v(" "),a("p",[t._v("注意是清除, 可以看到改方法有一个CacheEntryRemovedCallback参数,当此项被清除后会调用该callback方法")]),t._v(" "),a("p",[t._v('如果想"更新", 现在看到这个callback方法应该知道怎么做了')]),t._v(" "),a("p",[t._v("看着微软的帮助一步一步做下来简单, 但出了一个问题,就是刚Add进去, 马上CacheEntryRemovedCallback方法就被调用了, 数据改变了? 确认一下没有,")]),t._v(" "),a("p",[t._v("继续研究帮助,")]),t._v(" "),a("p",[t._v("看一下SqlChangeMonitor的构造函数, 参数是SqlDependency")]),t._v(" "),a("p",[t._v("SqlDependency是"),a("span",[t._v("System.Data.SqlClient 命名空间中的, ")])]),t._v(" "),a("p",[a("span",[t._v('微软这样说:<span id="mt1" class="sentence" data-guid="7b4342c39141bf07ce76e6cdb415e487" data-source="The <span class=" selflink"="">SqlDependency object represents a query notification dependency between an application and an instance of SQL Server.">'),a("span",{staticClass:"selflink"},[t._v("SqlDependency 对象都表示应用程序和 SQL Server 实例之间的查询通知依赖项。")]),t._v('<span id="mt2" class="sentence" data-guid="6c56e3e152ff6ffd5b023c77c4402f2c" data-source=" An application can create a <span class=" selflink"="">SqlDependency object and register to receive notifications via the '),a("span",{staticClass:"mtpsTagOuterHtml"},[t._v('OnChangeEventHandler event handler."> 应用程序可以创建 '),a("span",{staticClass:"selflink"},[t._v("SqlDependency 对象并进行注册以接收通知通过 OnChangeEventHandler 事件处理程序。")])])])]),t._v(" "),a("p",[a("span",[t._v('<span class="sentence" data-guid="7b4342c39141bf07ce76e6cdb415e487" data-source="The <span class=" selflink"="">SqlDependency object represents a query notification dependency between an application and an instance of SQL Server."><span class="sentence" data-guid="6c56e3e152ff6ffd5b023c77c4402f2c" data-source=" An application can create a <span class=" selflink"="">SqlDependency object and register to receive notifications via the '),a("span",{staticClass:"mtpsTagOuterHtml"},[t._v('OnChangeEventHandler event handler.">'),a("span",{staticClass:"selflink"},[t._v('原来此对象是数据库中做监视和通知用的, 被"征用"过来的.')])])])]),t._v(" "),a("p",[a("span",[t._v('<span class="sentence" data-guid="7b4342c39141bf07ce76e6cdb415e487" data-source="The <span class=" selflink"="">SqlDependency object represents a query notification dependency between an application and an instance of SQL Server."><span class="sentence" data-guid="6c56e3e152ff6ffd5b023c77c4402f2c" data-source=" An application can create a <span class=" selflink"="">SqlDependency object and register to receive notifications via the '),a("span",{staticClass:"mtpsTagOuterHtml"},[t._v('OnChangeEventHandler event handler.">'),a("span",{staticClass:"selflink"},[t._v("这就好办了, 根据帮助文档, 发现这个sql的要求真不是一般的严格")])])])]),t._v(" "),a("p",[a("span",[t._v('<span class="sentence" data-guid="7b4342c39141bf07ce76e6cdb415e487" data-source="The <span class=" selflink"="">SqlDependency object represents a query notification dependency between an application and an instance of SQL Server."><span class="sentence" data-guid="6c56e3e152ff6ffd5b023c77c4402f2c" data-source=" An application can create a <span class=" selflink"="">SqlDependency object and register to receive notifications via the '),a("span",{staticClass:"mtpsTagOuterHtml"},[t._v('OnChangeEventHandler event handler.">'),a("span",{staticClass:"selflink"},[t._v('现在说一下这个"sql", 这个sql首先要求是一个select语句,然后:')])])])]),t._v(" "),a("div",{staticClass:"sectionblock"},[a("ul",[a("li")]),t._v(" "),a("p",[t._v("必须显式说明 SELECT 语句中提取的列，并且表名必须限定为两部分组成的名称。注意，这意味着语句中引用的所有表都必须处于同一数据库中。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能使用星号 ("),a("em",[t._v(") 或 "),a("span",{staticClass:"parameter"},[t._v("table_name.")])]),t._v(" 语法指定列。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能使用未命名列或重复的列名。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句必须引用基表。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用具有计算列的表。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("在 SELECT 语句中提取的列不能包含聚合表达式，除非语句使用 GROUP BY 表达式。提供 GROUP BY 表达式时，选择列表便可以包含聚合函数 COUNT_BIG() 或 SUM()。但是，不能为可为空的列指定 SUM()。语句不能指定 HAVING、CUBE 或 ROLLUP。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("在用作简单表达式的 SELECT 语句中提取的列不能多次显示。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能包含 PIVOT 或 UNPIVOT 运算符。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能包含 UNION、INTERSECT 或 EXCEPT 运算符。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用视图。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能包含下列任意一个：DISTINCT、COMPUTE、COMPUTE BY 或 INTO。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用服务器全局变量 (@@"),a("span",{staticClass:"parameter"},[t._v("variable_name)。")])]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用派生表、临时表或表变量。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能从其他数据库或服务器中引用表或视图。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能包含子查询、外部联接或自联接。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用下列大型对象类型："),a("span",{staticClass:"input"},[t._v("text、"),a("span",{staticClass:"input"},[t._v("ntext 和 "),a("span",{staticClass:"input"},[t._v("image。")])])])]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能使用 CONTAINS 或 FREETEXT 全文谓词。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能使用行集函数，包括 OPENROWSET 和 OPENQUERY。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能使用下列任何一个聚合函数：AVG、COUNT(*)、MAX、MIN、STDEV、STDEVP、VAR 或 VARP。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能使用任何具有不确定性的函数，包括排名函数和开窗函数。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能包含用户定义聚合。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用系统表或视图，包括目录视图和动态管理视图。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能包含 FOR BROWSE 信息。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用队列。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能包含无法更改和无法返回结果的条件语句（如 WHERE 1=0）。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能指定 READPAST 锁提示。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用任何 Service Broker QUEUE。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能引用同义词。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不能具有基于 double/real 数据类型的比较或表达式。")]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("p",[t._v("语句不得使用 "),a("a",{attrs:{href:"https://msdn.microsoft.com/zh-cn/library/ms189463.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("TOP"),a("OutboundLink")],1),t._v(" 表达式。")])]),t._v(" "),a("p",[a("span",[t._v("多吧, 还有个问题,就是要启用数据库的BROKER ")])]),t._v(" "),a("p",[a("span",[t._v("ALTER "),a("span",{staticClass:"code-keyword"},[t._v("DATABASE database_name "),a("span",{staticClass:"code-keyword"},[t._v("SET TRUSTWORTHY "),a("span",{staticClass:"code-keyword"},[t._v("ON "),a("span",{staticClass:"code-keyword"},[t._v("WITH "),a("span",{staticClass:"code-keyword"},[t._v("ROLLBACK IMMEDIATE"),a("br"),t._v(" "),a("span",{staticClass:"code-keyword"},[t._v("ALTER "),a("span",{staticClass:"code-keyword"},[t._v("DATABASE database_name "),a("span",{staticClass:"code-keyword"},[t._v("SET ENABLE_BROKER "),a("span",{staticClass:"code-keyword"},[t._v("WITH "),a("span",{staticClass:"code-keyword"},[t._v("ROLLBACK IMMEDIATE"),a("br"),t._v(" "),a("span",{staticClass:"code-keyword"},[t._v("ALTER "),a("span",{staticClass:"code-keyword"},[t._v("AUTHORIZATION "),a("span",{staticClass:"code-keyword"},[t._v("ON DATABASE::database_name "),a("span",{staticClass:"code-keyword"},[t._v("TO sa")])])])])])])])])])])])])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);